<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>TOEFL Speaking Mock Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      line-height: 1.6;
    }
    h1 {
      text-align: center;
    }
    .question {
      margin-top: 30px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
    }
    audio {
      margin-top: 10px;
      width: 100%;
    }
    
    /* è€ƒè¯•è§„åˆ™æŠ˜å é¢æ¿æ ·å¼ */
    .rules-container {
      margin-bottom: 30px;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .rules-header {
      background-color: #e8f4fd;
      padding: 15px 20px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: background-color 0.3s;
    }
    
    .rules-header:hover {
      background-color: #d1e9ff;
    }
    
    .rules-header span {
      font-weight: 600;
      color: #1976D2;
      font-size: 16px;
    }
    
    .toggle-icon {
      font-size: 20px;
      color: #1976D2;
      transition: transform 0.3s;
    }
    
    .rules-content {
      padding: 25px;
      background-color: white;
      display: none;
      border-top: 1px solid #e0e0e0;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .rules-content.show {
      display: block;
    }
    
    /* è§„åˆ™å†…å®¹æ ·å¼ */
    .rules-content h3 {
      margin-top: 0;
      color: #333;
      font-size: 20px;
    }
    
    .rules-content h4 {
      margin: 20px 0 10px;
      color: #1976D2;
      font-size: 18px;
    }
    
    .rules-content h4:first-of-type {
      margin-top: 0;
    }
    
    .rules-content ul {
      margin: 10px 0;
      padding-left: 20px;
    }
    
    .rules-content li {
      margin: 5px 0;
    }
    
    .rules-content p {
      margin: 10px 0;
    }
    
    .rules-content hr {
      border: none;
      border-top: 1px solid #eee;
      margin: 20px 0;
    }
    
    /* é¡µè„šæ ·å¼ */
    .footer {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid #eee;
      text-align: center;
      color: #666;
    }
    
    .footer a {
      color: #2196F3;
      text-decoration: none;
    }
    
    .footer a:hover {
      text-decoration: underline;
    }
    
    /* æ–°å¢ï¼šå…³é—­æŒ‰é’®æ ·å¼ */
    .close-rules {
      text-align: right;
      margin-bottom: 15px;
    }
    
    .close-rules button {
      background: none;
      border: none;
      color: #666;
      cursor: pointer;
      font-size: 14px;
      padding: 5px 10px;
    }
    
    .close-rules button:hover {
      color: #1976D2;
    }
  </style>
</head>

<body>

  <!-- åˆ é™¤åŸæ¥çš„ exam-infoï¼Œæ›¿æ¢ä¸ºæŠ˜å é¢æ¿ -->
  <div class="rules-container">
    <div class="rules-header" onclick="toggleRules()">
      <span>ğŸ“‹ ç‚¹å‡»æŸ¥çœ‹è€ƒè¯•è§„åˆ™å’Œè¯´æ˜</span>
      <span class="toggle-icon" id="toggleIcon">â–¼</span>
    </div>
    <div class="rules-content" id="rulesContent">
      <div class="close-rules">
        <button onclick="toggleRules()">âœ• å…³é—­</button>
      </div>
      
      <h3>TOEFL Speaking Online Exam System</h3>
      <p>åœ¨çº¿æ‰˜ç¦å£è¯­æ¨¡è€ƒç³»ç»Ÿï¼Œç”¨äºæ•™å¸ˆç»„ç»‡é™æ—¶å£è¯­è€ƒè¯•å¹¶è‡ªåŠ¨æ”¶é›†å­¦ç”Ÿå½•éŸ³ã€‚</p>
      
      <hr>
      
      <h4>ğŸ‘©â€ğŸ« æ•™å¸ˆä¿¡æ¯</h4>
      <ul>
        <li><strong>æ•™å¸ˆé‚®ç®±ï¼š</strong>ulaan0827@gmail.com</li>
        <li><strong>æ¥æ”¶é‚®ç®±ï¼š</strong>ulaan0827@gmail.com</li>
      </ul>
      <p>å­¦ç”Ÿæäº¤çš„å½•éŸ³å°†è‡ªåŠ¨å‘é€è‡³ä¸Šè¿°é‚®ç®±ã€‚</p>
      
      <h4>â° è€ƒè¯•è§„åˆ™</h4>
      <ul>
        <li><strong>è€ƒè¯•æ—¶é•¿ï¼š</strong>8â€“10 åˆ†é’Ÿï¼ˆå¯è°ƒæ•´ï¼‰</li>
        <li><strong>å±å¹•åˆ‡æ¢è§„åˆ™ï¼š</strong>
          <ul>
            <li>ç¬¬ 1 æ¬¡ï¼šè­¦å‘Š</li>
            <li>ç¬¬ 2 æ¬¡ï¼šè‡ªåŠ¨äº¤å·</li>
          </ul>
        </li>
      </ul>
      <p>è¯·ç¡®ä¿å­¦ç”Ÿåœ¨è€ƒè¯•å¼€å§‹å‰äº†è§£ä»¥ä¸Šè§„åˆ™ã€‚</p>
      
      <h4>ğŸ§ è€ƒè¯•ç»“æ„ï¼ˆæ–°æ‰˜ç¦å£è¯­é¢˜å‹ï¼‰</h4>
      <p>æœ¬è€ƒè¯•é‡‡ç”¨æ–°æ‰˜ç¦å£è¯­é¢˜å‹ï¼Œå…±åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
      
      <h5>1. å¬è¯»æ¨¡ä»¿</h5>
      <ul>
        <li>å­¦ç”Ÿå¬ä¸€æ®µçŸ­å¥æˆ–çŸ­æ–‡</li>
        <li>éŸ³é¢‘è‡ªåŠ¨æ’­æ”¾</li>
        <li>å­¦ç”Ÿé‡å¤æ‰€å¬åˆ°çš„å†…å®¹</li>
        <li>å›ç­”å°†è¢«å³æ—¶å½•éŸ³</li>
      </ul>
      
      <h5>2. é¢è¯•é—®ç­”</h5>
      <ul>
        <li>å­¦ç”Ÿå›ç­”å¼€æ”¾å¼é¢è¯•é—®é¢˜</li>
        <li>é—®é¢˜æ¶‰åŠï¼š
          <ul>
            <li>ä¸ªäººç»å†</li>
            <li>è§‚ç‚¹è¡¨è¾¾</li>
            <li>ç®€å•è®ºè¿°</li>
          </ul>
        </li>
        <li>é™æ—¶ä½œç­”</li>
        <li>æ‰€æœ‰å›ç­”è‡ªåŠ¨å½•éŸ³</li>
      </ul>
      <p>â±ï¸ ä¸¤éƒ¨åˆ†å‡åœ¨æ€»è€ƒè¯•æ—¶é—´å†…å®Œæˆã€‚</p>
      
      <h4>ğŸ‘¨â€ğŸ“ å­¦ç”Ÿé¡»çŸ¥</h4>
      <ol>
        <li>ä½¿ç”¨ <strong>Google Chrome æµè§ˆå™¨</strong></li>
        <li>è€ƒå‰æ£€æŸ¥ï¼š
          <ul>
            <li>éº¦å…‹é£æƒé™å·²å¼€å¯</li>
            <li>ç½‘ç»œè¿æ¥ç¨³å®š</li>
          </ul>
        </li>
        <li>ç‚¹å‡»æ•™å¸ˆæä¾›çš„è€ƒè¯•é“¾æ¥</li>
        <li>ä»”ç»†é˜…è¯»å±å¹•æç¤º</li>
        <li>è¯·<strong>å‹¿</strong>ï¼š
          <ul>
            <li>åˆ·æ–°é¡µé¢</li>
            <li>åˆ‡æ¢æµè§ˆå™¨æ ‡ç­¾</li>
            <li>æ‰“å¼€å…¶ä»–åº”ç”¨</li>
          </ul>
        </li>
      </ol>
      <p>âš ï¸ å±å¹•åˆ‡æ¢å°†è§¦å‘è­¦å‘Šæˆ–è‡ªåŠ¨äº¤å·ã€‚</p>
      
      <h4>ğŸ“¤ è€ƒè¯•ç»“æŸå</h4>
      <ul>
        <li>æ‰€æœ‰å½•éŸ³è‡ªåŠ¨ä¸Šä¼ </li>
        <li>æ•™å¸ˆå°†é€šè¿‡é‚®ä»¶æ”¶åˆ°éŸ³é¢‘æ–‡ä»¶</li>
        <li>å­¦ç”Ÿæ— éœ€æ‰‹åŠ¨æäº¤ä»»ä½•å†…å®¹</li>
      </ul>
      
      <h4>ğŸ› ï¸ æŠ€æœ¯è¯´æ˜ï¼ˆä¾›æ•™å¸ˆå‚è€ƒï¼‰</h4>
      <ul>
        <li>å‰ç«¯ï¼šç½‘é¡µç‰ˆè€ƒè¯•ç•Œé¢</li>
        <li>åç«¯ï¼šå¤„ç†å½•éŸ³ä¸Šä¼ åŠé‚®ä»¶å‘é€</li>
        <li>ä»“åº“ç»“æ„ï¼š
          <ul>
            <li><code>/frontend</code> â€“ å­¦ç”Ÿè€ƒè¯•ç•Œé¢</li>
            <li><code>/backend</code> â€“ æœåŠ¡ç«¯åŠé‚®ä»¶é€»è¾‘</li>
          </ul>
        </li>
      </ul>
      <p>è€ƒè¯•å½“å¤©æ— éœ€æ“ä½œå‘½ä»¤è¡Œã€‚</p>
      
      <h4>âœ… è€ƒå‰æ£€æŸ¥æ¸…å•</h4>
      <ul style="list-style-type: none; padding-left: 0;">
        <li>â˜ æµ‹è¯•è€ƒè¯•é“¾æ¥</li>
        <li>â˜ æµ‹è¯•éº¦å…‹é£</li>
        <li>â˜ ç¡®è®¤è€ƒè¯•æ—¶é•¿</li>
        <li>â˜ å‘å­¦ç”Ÿè¯´æ˜è€ƒè¯•è§„åˆ™</li>
      </ul>
      
      <h4>ğŸ“Œ è”ç³»æ–¹å¼</h4>
      <p>è€ƒè¯•ä¸­å¦‚é‡æŠ€æœ¯é—®é¢˜ï¼Œè¯·è”ç³»æ•™å¸ˆã€‚</p>
      <p>ç¥è€ƒè¯•é¡ºåˆ©ï¼</p>
    </div>
  </div>

  <h1>TOEFL Speaking Test</h1>

  <div class="question">
    <h2>Part 1: Listen & Repeat</h2>
    <p>Listen to the sentence and repeat it.</p>

    <audio controls>
      <source src="audio/part1_sentence1.mp3.mp3" type="audio/mpeg">
    </audio>

    <audio controls>
      <source src="audio/part1_sentence2.mp3.mp3" type="audio/mpeg">
    </audio>

    <audio controls>
      <source src="audio/part1_sentence3.mp3.mp3" type="audio/mpeg">
    </audio>

    <audio controls>
      <source src="audio/part1_sentence4.mp3.mp3" type="audio/mpeg">
    </audio>

    <button onclick="startRecording(event)">Start Recording</button>
  </div>

  <div class="question">
    <h2>Part 2: Interview Question</h2>
    <p>Describe a teacher who has influenced you. â€” Watch student responses:</p>

    <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
      <div style="flex: 1 1 calc(50% - 20px); background: #f9f9f9; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <video width="100%" height="180" controls style="border-radius: 8px;">
          <source src="q1-interview.mp4" type="video/mp4">
        </video>
        <p style="font-weight: bold; margin-top: 10px;">ğŸ“Œ Question 1</p>
      </div>
      <div style="flex: 1 1 calc(50% - 20px); background: #f9f9f9; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <video width="100%" height="180" controls style="border-radius: 8px;">
          <source src="q2-interview.mp4" type="video/mp4">
        </video>
        <p style="font-weight: bold; margin-top: 10px;">ğŸ“Œ Question 2</p>
      </div>
      <div style="flex: 1 1 calc(50% - 20px); background: #f9f9f9; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <video width="100%" height="180" controls style="border-radius: 8px;">
          <source src="q3-interview.mp4" type="video/mp4">
        </video>
        <p style="font-weight: bold; margin-top: 10px;">ğŸ“Œ Question 3</p>
      </div>
      <div style="flex: 1 1 calc(50% - 20px); background: #f9f9f9; border-radius: 12px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
        <video width="100%" height="180" controls style="border-radius: 8px;">
          <source src="q4-interview.mp4" type="video/mp4">
        </video>
        <p style="font-weight: bold; margin-top: 10px;">ğŸ“Œ Question 4</p>
      </div>
    </div>

    <button onclick="startRecording(event)" style="margin-top: 20px;">Start Recording</button>
  </div>
  
  <!-- ä¿®æ”¹åº•éƒ¨é“¾æ¥ï¼Œæ”¹ä¸ºå±•å¼€è§„åˆ™é¢æ¿ -->
  <div class="footer">
    <p>
      <a href="#" onclick="toggleRules(); return false;">ğŸ“– æŸ¥çœ‹å®Œæ•´çš„è€ƒè¯•è§„åˆ™å’Œè¯´æ˜</a>
      <span style="margin: 0 10px; color: #ccc;">|</span>
      <a href="#" onclick="window.scrollTo({top: 0, behavior: 'smooth'}); return false;">â¬† è¿”å›é¡¶éƒ¨</a>
    </p>
    <p style="font-size: 12px; margin-top: 10px; color: #999;">
      Â© TOEFL Speaking Mock Test System | è€ƒè¯•æ—¶é—´: 8-10åˆ†é’Ÿ | è¯·å‹¿åˆ‡æ¢å±å¹•
    </p>
  </div>

  <script>
    // å…¨å±€å˜é‡
    let mediaRecorder;
    let audioChunks = [];
    let recordingStream = null;

    // æ–°å¢ï¼šæŠ˜å é¢æ¿åˆ‡æ¢å‡½æ•°
    function toggleRules() {
      const content = document.getElementById('rulesContent');
      const icon = document.getElementById('toggleIcon');
      
      if (content.classList.contains('show')) {
        content.classList.remove('show');
        icon.innerHTML = 'â–¼';
        // å¹³æ»‘æ»šåŠ¨åˆ°é¡¶éƒ¨
        window.scrollTo({top: 0, behavior: 'smooth'});
      } else {
        content.classList.add('show');
        icon.innerHTML = 'â–²';
        // å¹³æ»‘æ»šåŠ¨åˆ°é¢æ¿ä½ç½®
        setTimeout(() => {
          document.querySelector('.rules-container').scrollIntoView({behavior: 'smooth'});
        }, 100);
      }
    }

    // Part 1 & Part 2 å…±ç”¨çš„å½•éŸ³å‡½æ•°
    async function startRecording(event) {
      // âœ… ä¿®å¤ï¼šç¡®ä¿ event å­˜åœ¨
      if (!event) event = window.event;
      
      try {
        // 1. æ£€æŸ¥æµè§ˆå™¨å…¼å®¹æ€§
        if (!navigator.mediaDevices || !window.MediaRecorder) {
          alert('âŒ æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒå½•éŸ³åŠŸèƒ½ã€‚è¯·ä½¿ç”¨ Chromeã€Firefox æˆ– Edge æœ€æ–°ç‰ˆæœ¬ã€‚');
          return;
        }

        // 2. è¯·æ±‚éº¦å…‹é£æƒé™
        const stream = await navigator.mediaDevices.getUserMedia({ 
          audio: {
            echoCancellation: true,
            noiseSuppression: true,
            sampleRate: 16000
          } 
        });
        
        recordingStream = stream;
        
        // 3. åˆå§‹åŒ– MediaRecorder
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        // 4. æ”¶é›†éŸ³é¢‘æ•°æ®å—
        mediaRecorder.ondataavailable = (event) => {
          if (event.data.size > 0) {
            audioChunks.push(event.data);
          }
        };

        // 5. å½•éŸ³åœæ­¢æ—¶çš„å¤„ç†
        mediaRecorder.onstop = () => {
          // ç”ŸæˆéŸ³é¢‘æ–‡ä»¶
          const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
          const audioUrl = URL.createObjectURL(audioBlob);
          
          // åˆ›å»ºä¸´æ—¶éŸ³é¢‘æ’­æ”¾å™¨ç”¨äºå›æ”¾
          const audioPlayer = document.createElement('audio');
          audioPlayer.controls = true;
          audioPlayer.src = audioUrl;
          audioPlayer.style.width = '100%';
          audioPlayer.style.marginTop = '10px';
          
          // å°†æ’­æ”¾å™¨æ’å…¥åˆ°å½“å‰ç‚¹å‡»çš„æŒ‰é’®åé¢
          const activeButton = document.activeElement;
          if (activeButton && activeButton.tagName === 'BUTTON') {
            activeButton.parentNode.insertBefore(audioPlayer, activeButton.nextSibling);
          }
          
          console.log('âœ… å½•éŸ³å®Œæˆ');
          
          // é‡Šæ”¾éº¦å…‹é£èµ„æº
          if (recordingStream) {
            recordingStream.getTracks().forEach(track => track.stop());
            recordingStream = null;
          }
          
          // æ¸…ç©ºæ•°æ®å—
          audioChunks = [];
        };

        // 6. å¼€å§‹å½•éŸ³
        mediaRecorder.start();
        console.log('ğŸ¤ å½•éŸ³å·²å¼€å§‹');
        
        // 7. æ”¹å˜æŒ‰é’®çŠ¶æ€
        const currentBtn = event.target;
        if (currentBtn) {
          currentBtn.textContent = 'ğŸ”´ å½•éŸ³ä¸­...';
          currentBtn.style.background = '#ff4444';
          currentBtn.style.color = 'white';
          currentBtn.disabled = true;
          
          // æ·»åŠ åœæ­¢æŒ‰é’®
          const stopBtn = document.createElement('button');
          stopBtn.textContent = 'â¹ï¸ åœæ­¢å½•éŸ³';
          stopBtn.style.marginLeft = '10px';
          stopBtn.style.background = '#666';
          stopBtn.style.color = 'white';
          stopBtn.onclick = stopRecording;
          currentBtn.parentNode.insertBefore(stopBtn, currentBtn.nextSibling);
        }
        
      } catch (err) {
        console.error('å½•éŸ³å¯åŠ¨å¤±è´¥:', err);
        if (err.name === 'NotAllowedError') {
          alert('âŒ éº¦å…‹é£æƒé™è¢«æ‹’ç»ã€‚è¯·æ£€æŸ¥æµè§ˆå™¨åœ°å€æ çš„æƒé™è®¾ç½®ã€‚');
        } else if (err.name === 'NotFoundError') {
          alert('âŒ æœªæ£€æµ‹åˆ°éº¦å…‹é£è®¾å¤‡ã€‚è¯·è¿æ¥éº¦å…‹é£åé‡è¯•ã€‚');
        } else {
          alert(`å½•éŸ³å¤±è´¥: ${err.message}`);
        }
      }
    }

    // åœæ­¢å½•éŸ³å‡½æ•°
    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
        console.log('â¹ï¸ å½•éŸ³å·²åœæ­¢');
        
        // æ¢å¤æŒ‰é’®çŠ¶æ€
        const recordBtns = document.querySelectorAll('button[onclick="startRecording(event)"]');
        recordBtns.forEach(btn => {
          btn.textContent = 'Start Recording';
          btn.style.background = '';
          btn.style.color = '';
          btn.disabled = false;
        });
        
        // ç§»é™¤åœæ­¢æŒ‰é’®
        const stopBtns = document.querySelectorAll('button[onclick="stopRecording()"]');
        stopBtns.forEach(btn => btn.remove());
      }
    }

    // é¡µé¢å¸è½½æ—¶é‡Šæ”¾èµ„æº
    window.addEventListener('beforeunload', () => {
      if (recordingStream) {
        recordingStream.getTracks().forEach(track => track.stop());
      }
    });
  </script>
  
</body>
</html>
<!-- force rebuild: embedded README as collapsible panel -->
